<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ДОСТАНЬ КОРЕША 6.0</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --pc-yellow: #ffc600;
            --pc-black: #000000;
            --pc-blue-top: #8cb8ff;
            --pc-blue-bot: #5e8ddb;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: #333;
            font-family: 'VT323', monospace;
            overflow: hidden;
        }

        /* Экран входа */
        #login-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: var(--pc-yellow); display: flex; 
            flex-direction: column; justify-content: center; align-items: center; z-index: 1000;
        }
        .login-card {
            background: var(--pc-yellow); border: 4px double black; padding: 20px; text-align: center;
        }
        .login-card input {
            display: block; margin: 10px auto; padding: 10px; border: 2px solid black; font-family: 'VT323'; font-size: 20px;
        }

        /* Основной интерфейс */
        .app-container {
            display: flex; height: 100vh; background: var(--pc-yellow); border: 2px solid black; box-sizing: border-box;
        }

        /* Левая панель */
        .sidebar {
            width: 160px; display: flex; flex-direction: column; padding: 10px; border-right: 3px solid black;
        }
        .logo { font-size: 26px; font-weight: bold; color: white; text-shadow: 2px 2px black; margin-bottom: 10px; }
        .avatar-placeholder { background: black; height: 80px; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; }
        .chum-list { background: black; flex-grow: 1; border: 2px inset white; overflow-y: auto; padding: 5px; color: white; }
        
        /* Правая панель */
        .main-chat { flex-grow: 1; display: flex; flex-direction: column; padding: 5px; background: #c0c0c0; border: 2px solid black; margin: 5px; }
        .window-bar { background: linear-gradient(to bottom, var(--pc-blue-top), var(--pc-blue-bot)); color: white; padding: 5px; text-align: center; border: 1px solid white; font-size: 14px; margin-bottom: 5px; }
        .pesterlog { background: white; flex-grow: 1; border: 2px inset gray; padding: 10px; overflow-y: auto; font-family: 'Courier New', monospace; font-weight: bold; color: black; }
        
        .input-box { background: var(--pc-yellow); padding: 5px; border-top: 2px solid black; }
        textarea { width: 100%; height: 60px; border: 2px inset white; resize: none; font-family: 'Courier New'; font-weight: bold; font-size: 16px; box-sizing: border-box; }
        
        .btn { 
            background: #ccc; border: 2px outset white; padding: 5px; width: 100%; font-family: 'VT323'; font-size: 20px; cursor: pointer; margin-top: 5px;
        }
        .btn:active { border-style: inset; }
        .hidden { display: none !important; }

        @media (max-width: 600px) {
            .app-container { flex-direction: column; }
            .sidebar { width: 100%; height: 35%; border-right: none; border-bottom: 3px solid black; }
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card">
        <h1 style="margin:0;">ДОСТАНЬ КОРЕША 6.0</h1>
        <p>ВВЕДИ СВОЙ НИКНЕЙМ:</p>
        <input type="text" id="handleInput" placeholder="например: ghostDunk">
        <p>ЦВЕТ ТЕКСТА:</p>
        <input type="color" id="colorInput" value="#000000">
        <button class="btn" onclick="connectToServer()">ВОЙТИ</button>
    </div>
</div>

<div class="app-container">
    <div class="sidebar">
        <div class="logo">PESTERCHUM</div>
        <div class="avatar-placeholder">
            <img src="https://file.garden/Z8/smiley.png" width="60" alt=":)">
        </div>
        <div style="font-weight:bold; font-size:14px;">СПИСОК КОРЕШЕЙ:</div>
        <div class="chum-list" id="chumroll">
            </div>
        <div style="font-weight:bold; font-size:14px; margin-top:5px;">МОЙ НИК:</div>
        <div id="myHandleDisp" style="background:black; color:white; padding:2px; border:1px solid white;">offline</div>
    </div>

    <div class="main-chat">
        <div class="window-bar" id="chatTitle">:: pesterlog ::</div>
        <div class="pesterlog" id="logArea">
            <div style="color:gray; text-align:center;">-- ожидание подключения --</div>
        </div>
        <div class="input-box">
            <textarea id="msgInput" placeholder="Пиши сюда..."></textarea>
            <button class="btn" onclick="sendMsg()">ДОСТАТЬ!</button>
        </div>
    </div>
</div>

<script>
    // ТВОЯ ССЫЛКА НА RENDER
    const SERVER_URL = "https://pesterlog.onrender.com"; 
    let socket;
    let myData = { handle: "", color: "#000000", abbr: "" };

    function connectToServer() {
        const h = document.getElementById('handleInput').value.trim();
        const c = document.getElementById('colorInput').value;
        
        if(!h) return alert("Введите ник!");

        myData.handle = h;
        myData.color = c;
        myData.abbr = h.substring(0, 2).toUpperCase();

        // Подключаемся к сокету
        socket = io(SERVER_URL);

        socket.on('connect', () => {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('myHandleDisp').innerText = h;
            document.getElementById('logArea').innerHTML = `<div style="color:gray; text-align:center;">-- вы подключились к серверу --</div>`;
            socket.emit('join', myData);
        });

        socket.on('new_msg', (data) => {
            addMessage(data);
        });

        socket.on('system_msg', (txt) => {
            const div = document.createElement('div');
            div.style.color = "gray";
            div.style.textAlign = "center";
            div.style.margin = "10px 0";
            div.innerText = txt;
            document.getElementById('logArea').appendChild(div);
        });

        socket.on('connect_error', () => {
            alert("Ошибка подключения к серверу Render. Убедитесь, что он запущен!");
        });
    }

    function sendMsg() {
        const text = document.getElementById('msgInput').value.trim();
        if(!text || !socket) return;

        socket.emit('send_msg', {
            handle: myData.handle,
            abbr: myData.abbr,
            color: myData.color,
            message: text
        });
        document.getElementById('msgInput').value = "";
    }

    function addMessage(data) {
        const log = document.getElementById('logArea');
        const div = document.createElement('div');
        div.style.marginBottom = "5px";
        div.innerHTML = `<span style="color:${data.color}">${data.abbr}: ${data.message}</span>`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
    }
</script>

</body>
</html>
