<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>pester mini light</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>pester mini light</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { visibility:hidden; margin:0; font-family:'Courier Prime', monospace; display:flex; background:#fff; color:#000; height:100vh;}
body.loaded { visibility: visible; }

#sidebar { width:200px; background:#fff; border-right:3px solid #FFD700; padding:10px; box-shadow:2px 0 5px rgba(0,0,0,0.1); overflow-y:auto; }
#sidebar h4 { margin-top:0; color:#FFD700; }
.user { cursor:pointer; margin-bottom:5px; padding:6px; border-radius:4px; border:1px solid #FFD700; display:flex; justify-content:space-between; align-items:center; transition: background 0.3s;}
.user:hover { background:#fffacd;}
.status { font-size:12px; }

#chat-container { flex:1; display:flex; flex-direction:column; padding:10px; overflow:hidden; }
#chat { flex:1; border:2px solid #FFD700; padding:10px; border-radius:6px; margin-bottom:10px; background:#fff; overflow-y:auto; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }

#message { width:100%; height:50px; margin-top:5px; }

.private-chat { border:2px solid #FFD700; padding:5px; margin-top:10px; height:180px; overflow-y:auto; border-radius:6px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); animation:fadeIn 0.3s ease;}
.private-chat .messages { max-height:120px; overflow-y:auto; margin-bottom:5px; }

input, button, select { background:#fff; color:#000; border:1px solid #FFD700; font-family:'Courier Prime', monospace; margin:2px 0; padding:4px; border-radius:4px;}
button:hover, select:hover { background:#fffacd;}
.mood-buttons button { margin-right:5px; cursor:pointer;}

@keyframes fadeIn { from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);} }
</style>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
</head>
<body>

<div id="sidebar">
  <h4>chums</h4>
  <div id="users"></div>
</div>

<div id="chat-container">
  <h3>—Å–∏—Å—Ç–µ–º–∞</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <select id="colorSelect"></select>
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname = "";
let color = "";
let mood = "";

// –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
const nickColors = [
  "#FF4500","#1E90FF","#32CD32","#FFD700","#FF69B4","#8A2BE2","#00CED1","#FF6347","#FF1493","#00FA9A",
  "#FFA500","#7FFF00","#DC143C","#00BFFF","#8B008B","#ADFF2F","#FF1493","#20B2AA","#FF6347","#4682B4",
  "#BA55D3","#7CFC00","#FF00FF","#FF8C00","#00FF7F","#1E90FF","#FF69B4","#9370DB","#00FA9A","#FFB6C1"
];
function randomNickColor() { return nickColors[Math.floor(Math.random()*nickColors.length)]; }

// –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–∞
const adjectives = ["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns = ["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];
function randomNick(){ return adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)]; }

// —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
const nickAbbr = {
  "–õ—É–Ω–Ω—ã–π–¢—Ä–∏–∫—Å—Ç–µ—Ä":"–õ–¢",
  "–ö–æ—Ä–æ–ª—å–ë–æ—Ç–∞–Ω–æ–≤":"–ö–ë",
  "–í–∏–Ω–∏–ª–æ–≤—ã–π–î–µ–º–∏—Ä—É–≥":"–í–î",
  "–ü—É—Ä–ø—É—Ä–Ω—ã–π–•—Ä–∞–Ω–∏—Ç–µ–ª—å":"–ü–•",
  "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π–°–∫–∏—Ç–∞–ª–µ—Ü":"–ö–°",
  "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π–ú–∞–≥":"–≠–ú",
  "–õ—É–Ω–Ω—ã–π–ü—Ä–∏–∑—Ä–∞–∫":"–õ–ü",
  "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π–°–æ–∑–∏–¥–∞—Ç–µ–ª—å":"–°–°",
  "–ü—ã–ª–∞—é—â–∏–π–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä":"–ü–ê",
  "–¢—É–º–∞–Ω–Ω—ã–π–¢—Ä–∏–∫—Å—Ç–µ—Ä":"–¢–¢",
  "–®—É–º–Ω—ã–π–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä":"–®–ú",
  "–ì–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π–ü—Ä–æ–≤–∏–¥–µ—Ü":"–ì–ü",
  "–ö–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π–•—Ä–∞–Ω–∏—Ç–µ–ª—å":"–ö–•",
  "–î—Ä–µ–≤–Ω–∏–π–ö–æ—Ä–æ–ª—å":"–î–ö"
};

// –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ —Ü–≤–µ—Ç–∞–º–∏
const colorSelect = document.getElementById("colorSelect");
nickColors.forEach(c=>{
  const opt = document.createElement("option");
  opt.value=c; opt.style.color=c; opt.innerText=c;
  colorSelect.appendChild(opt);
});

// —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã –Ω–∏–∫–∞
function getAbbr(name){
  if(nickAbbr[name]) return nickAbbr[name];
  // –µ—Å–ª–∏ –Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ, –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞
  return name.match(/\b\p{L}/gu)?.join('') || name.slice(0,2);
}

window.onload = ()=>{
  let savedNick = localStorage.getItem("pesterNick");
  let savedColor = localStorage.getItem("pesterColor");
  let savedMood = localStorage.getItem("pesterMood");

  if(savedNick && savedColor){nickname=savedNick;color=savedColor;} else {nickname=randomNick(); color=randomNickColor(); localStorage.setItem("pesterNick",nickname); localStorage.setItem("pesterColor",color);}
  if(savedMood){mood=savedMood;} else {mood="üòÉ"; localStorage.setItem("pesterMood",mood);}

  document.getElementById("name").value = nickname;
  colorSelect.value = color;
  socket.emit("join",{name:nickname,color:color,mood:mood});
  document.body.classList.add('loaded');
};

// —Å–º–µ–Ω–∞ –Ω–∏–∫–∞
document.getElementById("name").addEventListener("change", ()=>{
  nickname = document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

// —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞ –Ω–∏–∫–∞
colorSelect.addEventListener("change", ()=>{
  color = colorSelect.value;
  localStorage.setItem("pesterColor",color);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

function send(){
  const message = document.getElementById("message").value;
  if(!nickname||!message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><span class="status">${user.mood}</span>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

let openChats={};

function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const myColor = color;
  const theirColor = toColor || randomNickColor();

  const chatDiv = document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`
    <strong style="color:${theirColor}">${to}</strong>
    <div class="messages"></div>
    <input placeholder="message">
    <div class="mood-buttons">
      <button onclick="sendPrivateMood('${to}','üòÉ')">üòÉ</button>
      <button onclick="sendPrivateMood('${to}','üò°')">üò°</button>
      <button onclick="sendPrivateMood('${to}','üò¥')">üò¥</button>
    </div>
    <button class="send-btn">send</button>
  `;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const messagesDiv = chatDiv.querySelector(".messages");
  const input = chatDiv.querySelector("input");
  const button = chatDiv.querySelector(".send-btn");

  const abbrFrom = getAbbr(nickname);
  const abbrTo = getAbbr(to);
  const sysMsg = document.createElement("div");
  sysMsg.style.fontStyle = "italic";
  sysMsg.innerText = `[${abbrFrom}] –Ω–∞—á–∞–ª –¥–æ—Å—Ç–∞–≤–∞—Ç—å [${abbrTo}]`;
  messagesDiv.appendChild(sysMsg);

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color:myColor});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if((data.from===nickname && data.to===to)||(data.from===to && data.to===nickname)){
      const div=document.createElement("div");
      div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
}

function sendPrivateMood(to,emoji){
  mood=emoji;
  localStorage.setItem("pesterMood",mood);
  socket.emit("update mood",{mood:emoji});
}

socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop = chat.scrollHeight;
});
</script>
</body>
</html> margin:0; font-family:'Courier Prime', monospace; display:flex; background:#fff; color:#000; height:100vh;}
body.loaded { visibility: visible; }

#sidebar { width:200px; background:#fff; border-right:3px solid #FFD700; padding:10px; box-shadow:2px 0 5px rgba(0,0,0,0.1); overflow-y:auto; }
#sidebar h4 { margin-top:0; color:#FFD700; }
.user { cursor:pointer; margin-bottom:5px; padding:6px; border-radius:4px; border:1px solid #FFD700; display:flex; justify-content:space-between; align-items:center; transition: background 0.3s;}
.user:hover { background:#fffacd;}
.status { font-size:12px; }

#chat-container { flex:1; display:flex; flex-direction:column; padding:10px; overflow:hidden; }
#chat { flex:1; border:2px solid #FFD700; padding:10px; border-radius:6px; margin-bottom:10px; background:#fff; overflow-y:auto; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }

.private-chat { border:2px solid #FFD700; padding:5px; margin-top:10px; height:180px; overflow-y:auto; border-radius:6px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); animation:fadeIn 0.3s ease;}
.private-chat .messages { max-height:120px; overflow-y:auto; margin-bottom:5px; }

input, button, select { background:#fff; color:#000; border:1px solid #FFD700; font-family:'Courier Prime', monospace; margin:2px 0; padding:4px; border-radius:4px;}
button:hover, select:hover { background:#fffacd;}
.mood-buttons button { margin-right:5px; cursor:pointer;}

@keyframes fadeIn { from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);} }
</style>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
</head>
<body>

<div id="sidebar">
  <h4>chums</h4>
  <div id="users"></div>
</div>

<div id="chat-container">
  <h3>—Å–∏—Å—Ç–µ–º–∞</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <select id="colorSelect"></select>
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname = "";
let color = "";
let mood = "";

// –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
const nickColors = [
  "#FF4500","#1E90FF","#32CD32","#FFD700","#FF69B4","#8A2BE2","#00CED1","#FF6347","#FF1493","#00FA9A",
  "#FFA500","#7FFF00","#DC143C","#00BFFF","#8B008B","#ADFF2F","#FF1493","#20B2AA","#FF6347","#4682B4",
  "#BA55D3","#7CFC00","#FF00FF","#FF8C00","#00FF7F","#1E90FF","#FF69B4","#9370DB","#00FA9A","#FFB6C1"
];
function randomNickColor() { return nickColors[Math.floor(Math.random()*nickColors.length)]; }

// –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–∞
const adjectives = ["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns = ["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];
function randomNick(){ return adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)]; }

// —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
const nickAbbr = {
  "–õ—É–Ω–Ω—ã–π–¢—Ä–∏–∫—Å—Ç–µ—Ä":"–õ–¢",
  "–ö–æ—Ä–æ–ª—å–ë–æ—Ç–∞–Ω–æ–≤":"–ö–ë",
  "–í–∏–Ω–∏–ª–æ–≤—ã–π–î–µ–º–∏—Ä—É–≥":"–í–î",
  "–ü—É—Ä–ø—É—Ä–Ω—ã–π–•—Ä–∞–Ω–∏—Ç–µ–ª—å":"–ü–•",
  "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π–°–∫–∏—Ç–∞–ª–µ—Ü":"–ö–°",
  "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π–ú–∞–≥":"–≠–ú",
  "–õ—É–Ω–Ω—ã–π–ü—Ä–∏–∑—Ä–∞–∫":"–õ–ü",
  "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π–°–æ–∑–∏–¥–∞—Ç–µ–ª—å":"–°–°",
  "–ü—ã–ª–∞—é—â–∏–π–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä":"–ü–ê",
  "–¢—É–º–∞–Ω–Ω—ã–π–¢—Ä–∏–∫—Å—Ç–µ—Ä":"–¢–¢",
  "–®—É–º–Ω—ã–π–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä":"–®–ú",
  "–ì–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π–ü—Ä–æ–≤–∏–¥–µ—Ü":"–ì–ü",
  "–ö–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π–•—Ä–∞–Ω–∏—Ç–µ–ª—å":"–ö–•",
  "–î—Ä–µ–≤–Ω–∏–π–ö–æ—Ä–æ–ª—å":"–î–ö"
};

// –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ —Ü–≤–µ—Ç–∞–º–∏
const colorSelect = document.getElementById("colorSelect");
nickColors.forEach(c=>{
  const opt = document.createElement("option");
  opt.value=c; opt.style.color=c; opt.innerText=c;
  colorSelect.appendChild(opt);
});

window.onload = ()=>{
  let savedNick = localStorage.getItem("pesterNick");
  let savedColor = localStorage.getItem("pesterColor");
  let savedMood = localStorage.getItem("pesterMood");

  if(savedNick && savedColor){nickname=savedNick;color=savedColor;} else {nickname=randomNick(); color=randomNickColor(); localStorage.setItem("pesterNick",nickname); localStorage.setItem("pesterColor",color);}
  if(savedMood){mood=savedMood;} else {mood="üòÉ"; localStorage.setItem("pesterMood",mood);}

  document.getElementById("name").value = nickname;
  colorSelect.value = color;
  socket.emit("join",{name:nickname,color:color,mood:mood});
  document.body.classList.add('loaded');
};

// —Å–º–µ–Ω–∞ –Ω–∏–∫–∞
document.getElementById("name").addEventListener("change", ()=>{
  nickname = document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

// —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞ –Ω–∏–∫–∞
colorSelect.addEventListener("change", ()=>{
  color = colorSelect.value;
  localStorage.setItem("pesterColor",color);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

function send(){
  const message = document.getElementById("message").value;
  if(!nickname||!message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><span class="status">${user.mood}</span>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

let openChats={};

function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const myColor = color;
  const theirColor = toColor || randomNickColor();

  const chatDiv = document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`
    <strong style="color:${theirColor}">${to}</strong>
    <div class="messages"></div>
    <input placeholder="message">
    <div class="mood-buttons">
      <button onclick="sendPrivateMood('${to}','üòÉ')">üòÉ</button>
      <button onclick="sendPrivateMood('${to}','üò°')">üò°</button>
      <button onclick="sendPrivateMood('${to}','üò¥')">üò¥</button>
    </div>
    <button class="send-btn">send</button>
  `;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const messagesDiv = chatDiv.querySelector(".messages");
  const input = chatDiv.querySelector("input");
  const button = chatDiv.querySelector(".send-btn");

  const abbrFrom = nickAbbr[nickname] || nickname.slice(0,2).toUpperCase();
  const abbrTo = nickAbbr[to] || to.slice(0,2).toUpperCase();
  const sysMsg = document.createElement("div");
  sysMsg.style.fontStyle = "italic";
  sysMsg.innerText = `[${abbrFrom}] –Ω–∞—á–∞–ª –¥–æ—Å—Ç–∞–≤–∞—Ç—å [${abbrTo}]`;
  messagesDiv.appendChild(sysMsg);

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color:myColor});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if((data.from===nickname && data.to===to)||(data.from===to && data.to===nickname)){
      const div=document.createElement("div");
      div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
}

function sendPrivateMood(to,emoji){
  mood=emoji;
  localStorage.setItem("pesterMood",mood);
  socket.emit("update mood",{mood:emoji});
}

socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop = chat.scrollHeight;
});
</script>
</body>
</html>