<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>pester mini light</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
body { 
  visibility: hidden; 
  margin:0;
  font-family: 'Courier Prime', monospace;
  display:flex;
  background:#fff;
  color:#000;
  height:100vh;
}
body.loaded { visibility: visible; }

/* sidebar —Å –∫–æ—Ä–µ—à–∞–º–∏ */
#sidebar {
  width:200px;
  background:#fff;
  border-right:3px solid #FFD700;
  padding:10px;
  box-shadow: 2px 0 5px rgba(0,0,0,0.1);
  overflow-y:auto;
}
#sidebar h4 {margin-top:0; color:#FFD700;}
.user, #my-nick {
  margin-bottom:5px;
  padding:6px;
  border-radius:4px;
  border:1px solid #FFD700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.user:hover {background:#fffacd;}
.status {font-size:12px;}

/* –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
#chat-container { flex:1; display:flex; flex-direction:column; padding:10px; overflow:hidden; }
#chat { flex:1; border:2px solid #FFD700; padding:10px; border-radius:6px; margin-bottom:10px; background:#fff; overflow-y:auto; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
.private-chat { border:2px solid #FFD700; padding:5px; margin-top:10px; height:180px; overflow-y:auto; border-radius:6px; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); animation: fadeIn 0.3s ease; }
.private-chat .messages { max-height:120px; overflow-y:auto; margin-bottom:5px; }

/* input –∏ –∫–Ω–æ–ø–∫–∏ */
input, button {
  background:#fff; color:#000; border:1px solid #FFD700;
  font-family: 'Courier Prime', monospace; margin:2px 0; padding:4px; border-radius:4px;
}
button:hover {background:#fffacd;}
.mood-buttons button {margin-right:5px; cursor:pointer;}

/* –∞–Ω–∏–º–∞—Ü–∏—è */
@keyframes fadeIn {from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);}}
</style>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
</head>
<body>

<div id="sidebar">
  <h4>chums</h4>
  <div id="my-nick"></div> <!-- —Ç–≤–æ–π –Ω–∏–∫ -->
  <div id="users"></div>   <!-- –¥—Ä—É–≥–∏–µ –∫–æ—Ä–µ—à–∞ -->
</div>

<div id="chat-container">
  <h3>–æ–±—â–∏–π —á–∞—Ç</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const myNickDiv = document.getElementById("my-nick");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname="", color="", mood="";
const nickColors=["#FF4500","#1E90FF","#32CD32","#FFD700","#FF69B4","#8A2BE2","#00CED1","#FF6347","#FF1493","#00FA9A"];
const adjectives=["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns=["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];

function randomNick(){return adjectives[Math.floor(Math.random()*adjectives.length)]+nouns[Math.floor(Math.random()*nouns.length)];}
function randomColor(){return nickColors[Math.floor(Math.random()*nickColors.length)];}

window.onload=()=>{
  let savedNick=localStorage.getItem("pesterNick");
  let savedColor=localStorage.getItem("pesterColor");
  let savedMood=localStorage.getItem("pesterMood");
  if(savedNick && savedColor){nickname=savedNick;color=savedColor;} else {nickname=randomNick();color=randomColor();localStorage.setItem("pesterNick",nickname);localStorage.setItem("pesterColor",color);}
  if(savedMood){mood=savedMood;} else {mood="üòÉ";localStorage.setItem("pesterMood",mood);}
  document.getElementById("name").value=nickname;
  myNickDiv.innerHTML=`<span style="color:${color}">${nickname}</span> ${mood}`;
  socket.emit("join",{name:nickname,color:color,mood:mood});
  document.body.classList.add('loaded');
};

document.getElementById("name").addEventListener("change",()=>{
  nickname=document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

function send(){
  const message=document.getElementById("message").value;
  if(!nickname||!message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop=chat.scrollHeight;
});

socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><span class="status">${user.mood}</span>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
let openChats={};
function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const chatDiv=document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`<strong style="color:${toColor}">${to}</strong><div class="messages"></div>
  <input placeholder="message"><div class="mood-buttons">
  <button onclick="sendPrivateMood('${to}','üòÉ')">üòÉ</button>
  <button onclick="sendPrivateMood('${to}','üò°')">üò°</button>
  <button onclick="sendPrivateMood('${to}','üò¥')">üò¥</button>
  </div><button class="send-btn">send</button>`;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const input=chatDiv.querySelector("input");
  const button=chatDiv.querySelector(".send-btn");
  const messagesDiv=chatDiv.querySelector(".messages");

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if((data.from===nickname && data.to===to)||(data.from===to && data.to===nickname)){
      const div=document.createElement("div");
      div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop=messagesDiv.scrollHeight;
    }
  });
}

/* –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ */
function sendPrivateMood(to,emoji){
  mood=emoji;
  localStorage.setItem("pesterMood",mood);
  myNickDiv.innerHTML=`<span style="color:${color}">${nickname}</span> ${mood}`;
  socket.emit("update mood",{mood:emoji});
}
</script>
</body>
</html>  transition: background 0.3s;
}
.user:hover {background:#fffacd;}
.status {font-size:12px;}

/* –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
#chat-container {
  flex:1;
  display:flex;
  flex-direction:column;
  padding:10px;
  overflow:hidden;
}
#chat {
  flex:1;
  border:2px solid #FFD700;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
  background:#fff;
  overflow-y:auto;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
.private-chat {
  border:2px solid #FFD700;
  padding:5px;
  margin-top:10px;
  height:180px;
  overflow-y:auto;
  border-radius:6px;
  background:#fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  animation: fadeIn 0.3s ease;
}
.private-chat .messages {
  max-height:120px;
  overflow-y:auto;
  margin-bottom:5px;
}

/* input –∏ –∫–Ω–æ–ø–∫–∏ */
input, button {
  background:#fff;
  color:#000;
  border:1px solid #FFD700;
  font-family: 'Courier Prime', monospace;
  margin:2px 0;
  padding:4px;
  border-radius:4px;
}
button:hover {background:#fffacd;}
.mood-buttons button {margin-right:5px; cursor:pointer;}

/* –∞–Ω–∏–º–∞—Ü–∏—è */
@keyframes fadeIn {from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);}}
</style>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
</head>
<body>

<div id="sidebar">
  <h4>chums</h4>
  <div id="users"></div>
</div>

<div id="chat-container">
  <h3>—Å–∏—Å—Ç–µ–º–∞</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname = "";
let color = "";
let mood = "";

/* –±–æ–ª—å—à–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –Ω–∏–∫–∞ */
const nickColors = ["#FF4500","#1E90FF","#32CD32","#FFD700","#FF69B4","#8A2BE2","#00CED1","#FF6347","#FF1493","#00FA9A"];

/* –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–∞ */
const adjectives = ["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns = ["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];

function randomNick() {return adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)];}
function randomColor() {return nickColors[Math.floor(Math.random()*nickColors.length)];}

/* –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –Ω–∏–∫–∞ –∏ —Ü–≤–µ—Ç–∞ */
window.onload = ()=>{
  let savedNick = localStorage.getItem("pesterNick");
  let savedColor = localStorage.getItem("pesterColor");
  let savedMood = localStorage.getItem("pesterMood");
  if(savedNick && savedColor){nickname=savedNick;color=savedColor;} else {nickname=randomNick();color=randomColor();localStorage.setItem("pesterNick",nickname);localStorage.setItem("pesterColor",color);}
  if(savedMood){mood=savedMood;} else {mood="üòÉ";localStorage.setItem("pesterMood",mood);}
  document.getElementById("name").value = nickname;
  socket.emit("join",{name:nickname,color:color,mood:mood});
};

/* –∑–∞–ø—Ä–µ—â–∞–µ–º –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç */
document.getElementById("name").addEventListener("change", ()=>{
  nickname = document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color,mood:mood});
});

/* –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
function send(){
  const message = document.getElementById("message").value;
  if(!nickname||!message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

/* —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–µ—à–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è */
socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><span class="status">${user.mood}</span>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
let openChats={};

function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const chatDiv=document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`<strong style="color:${toColor}">${to}</strong><div class="messages"></div>
  <input placeholder="message"><div class="mood-buttons">
  <button onclick="sendPrivateMood('${to}','üòÉ')">üòÉ</button>
  <button onclick="sendPrivateMood('${to}','üò°')">üò°</button>
  <button onclick="sendPrivateMood('${to}','üò¥')">üò¥</button>
  </div><button class="send-btn">send</button>`;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const input=chatDiv.querySelector("input");
  const button=chatDiv.querySelector(".send-btn");
  const messagesDiv=chatDiv.querySelector(".messages");

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if((data.from===nickname && data.to===to)||(data.from===to && data.to===nickname)){
      const div=document.createElement("div");
      div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
}

/* –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ */
function sendPrivateMood(to,emoji){
  mood=emoji;
  localStorage.setItem("pesterMood",mood);
  socket.emit("update mood",{mood:emoji});
}

/* –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã */
socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop = chat.scrollHeight;
});
</script>
</body>
</html>  transform: translateX(3px);
}
.status {font-size:10px;color:gray;}

/* –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
#chat-container {
  flex:1;
  padding:10px;
  display:flex;
  flex-direction: column;
}

/* –æ–±—â–∏–π —á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
#chat {
  flex:1;
  height:150px;
  overflow-y:auto;
  border:2px solid #FFD700;
  padding:10px;
  background:#fff;
  margin-bottom:10px;
  border-radius:6px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
.private-chat {
  border:2px solid #FFD700;
  padding:5px;
  margin-top:10px;
  height:180px;
  overflow-y:auto;
  border-radius:6px;
  background:#fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  animation: fadeIn 0.3s ease;
}
.private-chat .messages {
  max-height:120px;
  overflow-y:auto;
  margin-bottom:5px;
}

/* input –∏ –∫–Ω–æ–ø–∫–∏ */
input, button {
  background:#fff;
  color:#000;
  border:1px solid #FFD700;
  font-family: monospace;
  margin:2px 0;
  padding:4px;
  border-radius:4px;
}
button:hover {background:#fffacd;}
.mood-buttons button {margin-right:5px; cursor:pointer;}

/* –∞–Ω–∏–º–∞—Ü–∏—è */
@keyframes fadeIn {
  from {opacity:0; transform: translateY(-5px);}
  to {opacity:1; transform: translateY(0);}
}
</style>
</head>
<body>

<!-- sidebar —Å –∫–æ—Ä–µ—à–∞–º–∏ -->
<div id="sidebar">
  <h4>chums</h4>
  <div id="users"></div>
</div>

<!-- –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
<div id="chat-container">
  <h3>—Å–∏—Å—Ç–µ–º–∞</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <!-- –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã -->
  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname = "";
let color = "";

/* –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–∞ */
const adjectives = ["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns = ["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];

function randomNick() {
  const adj = adjectives[Math.floor(Math.random()*adjectives.length)];
  const noun = nouns[Math.floor(Math.random()*nouns.length)];
  return adj+noun;
}

/* —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –Ω–∏–∫–∞ */
function randomColor() {
  const letters = '0123456789ABCDEF';
  let col = '#';
  for(let i=0;i<6;i++){ col+=letters[Math.floor(Math.random()*16)]; }
  return col;
}

/* –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –Ω–∏–∫–∞ –∏ —Ü–≤–µ—Ç–∞ */
window.onload = ()=>{
  let savedNick = localStorage.getItem("pesterNick");
  let savedColor = localStorage.getItem("pesterColor");
  if(savedNick && savedColor){
    nickname = savedNick;
    color = savedColor;
  } else {
    nickname = randomNick();
    color = randomColor();
    localStorage.setItem("pesterNick",nickname);
    localStorage.setItem("pesterColor",color);
  }
  document.getElementById("name").value = nickname;
  socket.emit("join",{name:nickname,color:color});
};

/* –∑–∞–ø—Ä–µ—â–∞–µ–º –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç */
document.getElementById("name").addEventListener("change", ()=>{
  nickname = document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color});
});

/* –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É */
function send(){
  const message = document.getElementById("message").value;
  if(!nickname || !message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

/* –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π */
socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop = chat.scrollHeight;
});

/* —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–µ—à–µ–π */
socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><div class="status">online</div>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
let openChats={};

function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const chatDiv=document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`<strong style="color:${toColor}">${to}</strong><div class="messages"></div>
  <input placeholder="message"><div class="mood-buttons">
  <button onclick="sendPrivateMood('${to}','üòÉ')">üòÉ</button>
  <button onclick="sendPrivateMood('${to}','üò°')">üò°</button>
  <button onclick="sendPrivateMood('${to}','üò¥')">üò¥</button>
  </div><button class="send-btn">send</button>`;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const input=chatDiv.querySelector("input");
  const button=chatDiv.querySelector(".send-btn");
  const messagesDiv=chatDiv.querySelector(".messages");

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if(data.from!==nickname && data.from!==to) return;
    const div=document.createElement("div");
    div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
}

/* –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ */
function sendPrivateMood(to,emoji){
  socket.emit("private message",{from:nickname,to,message:emoji,color});
}
</script>
</body>
</html>/* –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
#chat-container {
  flex:1;
  padding:10px;
  display:flex;
  flex-direction: column;
}
#chat {
  flex:1;
  height:200px;
  overflow-y:auto;
  border:2px solid #FFD700;
  padding:10px;
  background:#fff;
  margin-bottom:10px;
  border-radius:6px;
}

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
.private-chat {
  border:2px solid #FFD700;
  padding:5px;
  margin-top:10px;
  height:150px;
  overflow-y:auto;
  border-radius:6px;
  background:#fff;
}
.private-chat .messages {
  max-height:120px;
  overflow-y:auto;
}

/* input –∏ –∫–Ω–æ–ø–∫–∏ */
input, button {
  background:#fff;
  color:#000;
  border:1px solid #FFD700;
  font-family: monospace;
  margin:2px 0;
  padding:4px;
  border-radius:4px;
}
button:hover {background: #fffacd;}
.mood-buttons button {margin-right:5px;}
</style>
</head>
<body style="visibility:hidden;">

<!-- sidebar —Å –∫–æ—Ä–µ—à–∞–º–∏ -->
<div id="sidebar">
  <h4>chums</h4>
  <div id="users"></div>
</div>

<!-- –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
<div id="chat-container">
  <h3>–æ–±—â–∏–π —á–∞—Ç</h3>
  <div id="chat"></div>

  <input id="name" placeholder="nickname">
  <input id="message" placeholder="message">
  <button onclick="send()">send</button>

  <!-- –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è -->
  <div class="mood-buttons">
    <button onclick="sendMood('üòÉ')">üòÉ</button>
    <button onclick="sendMood('üò°')">üò°</button>
    <button onclick="sendMood('üò¥')">üò¥</button>
  </div>

  <!-- –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã -->
  <div id="private-chats"></div>
</div>

<audio id="ping">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const ping = document.getElementById("ping");
const privateChatsDiv = document.getElementById("private-chats");

let nickname = "";
let color = "";

/* –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–∞ */
const adjectives = ["–≤–∏–Ω–∏–ª–æ–≤—ã–π","–ø—É—Ä–ø—É—Ä–Ω—ã–π","–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π","—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π","–ª—É–Ω–Ω—ã–π","—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π","–ø—ã–ª–∞—é—â–∏–π","—Ç—É–º–∞–Ω–Ω—ã–π","—à—É–º–Ω—ã–π","–≥–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π","–∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π","–¥—Ä–µ–≤–Ω–∏–π"];
const nouns = ["–î–µ–º–∏—Ä—É–≥","–•—Ä–∞–Ω–∏—Ç–µ–ª—å","–ö–æ—Ä–æ–ª—å","–°–∫–∏—Ç–∞–ª–µ—Ü","–¢—Ä–∏–∫—Å—Ç–µ—Ä","–ú–∞–≥","–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","–¢–µ–Ω—å","–ü—Ä–∏–∑—Ä–∞–∫","–°–æ–∑–∏–¥–∞—Ç–µ–ª—å","–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä","–ü—Ä–æ–≤–∏–¥–µ—Ü"];

function randomNick() {
  const adj = adjectives[Math.floor(Math.random()*adjectives.length)];
  const noun = nouns[Math.floor(Math.random()*nouns.length)];
  return adj+noun;
}

/* —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –Ω–∏–∫–∞ */
function randomColor() {
  const letters = '0123456789ABCDEF';
  let col = '#';
  for(let i=0;i<6;i++){ col+=letters[Math.floor(Math.random()*16)]; }
  return col;
}

/* –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –Ω–∏–∫–∞ –∏ —Ü–≤–µ—Ç–∞ */
window.onload = ()=>{
  let savedNick = localStorage.getItem("pesterNick");
  let savedColor = localStorage.getItem("pesterColor");
  if(savedNick && savedColor){
    nickname = savedNick;
    color = savedColor;
  } else {
    nickname = randomNick();
    color = randomColor();
    localStorage.setItem("pesterNick",nickname);
    localStorage.setItem("pesterColor",color);
  }
  document.getElementById("name").value = nickname;
  socket.emit("join",{name:nickname,color:color});
};

/* –∑–∞–ø—Ä–µ—â–∞–µ–º –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç */
document.getElementById("name").addEventListener("change", ()=>{
  nickname = document.getElementById("name").value;
  localStorage.setItem("pesterNick",nickname);
  socket.emit("join",{name:nickname,color:color});
});

/* –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
function send(){
  const message = document.getElementById("message").value;
  if(!nickname || !message) return;
  socket.emit("chat message",{name:nickname,color:color,message:message});
  document.getElementById("message").value="";
}

/* –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è */
function sendMood(emoji){
  socket.emit("chat message",{name:nickname,color:color,message:emoji});
}

/* –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π */
socket.on("chat message",(data)=>{
  const div=document.createElement("div");
  div.innerHTML=`<span style="color:${data.color}">${data.name}:</span> ${data.message}`;
  chat.appendChild(div);
  ping.play();
  chat.scrollTop = chat.scrollHeight;
});

/* —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–µ—à–µ–π */
socket.on("user list",(users)=>{
  usersDiv.innerHTML="";
  users.forEach(user=>{
    if(user.name===nickname) return;
    const div=document.createElement("div");
    div.className="user";
    div.innerHTML=`<span style="color:${user.color}">${user.name}</span><div class="status">online</div>`;
    div.onclick=()=>openPrivateChat(user.name,user.color);
    usersDiv.appendChild(div);
  });
});

/* –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã */
let openChats={};

function openPrivateChat(to,toColor){
  if(openChats[to]) return;
  const chatDiv=document.createElement("div");
  chatDiv.className="private-chat";
  chatDiv.innerHTML=`<strong style="color:${toColor}">${to}</strong><div class="messages"></div>
  <input placeholder="message"><button>send</button>`;
  privateChatsDiv.appendChild(chatDiv);
  openChats[to]=chatDiv;

  const input=chatDiv.querySelector("input");
  const button=chatDiv.querySelector("button");
  const messagesDiv=chatDiv.querySelector(".messages");

  button.onclick=()=>{
    const msg=input.value;
    if(!msg) return;
    socket.emit("private message",{from:nickname,to,message:msg,color});
    input.value="";
  };

  socket.on("private message",(data)=>{
    if(data.from!==nickname && data.from!==to) return;
    const div=document.createElement("div");
    div.innerHTML=`<span style="color:${data.color}">${data.from}:</span> ${data.message}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    document.body.style.visibility = "visible";
  });
}
</script>
</body>
</html>
